<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Menu - Voreas Restaurant</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
  <header>
    <nav>
      <div class="logo">
        <img src="logo.png" alt="Logo" class="logo-img">
      </div>
      <ul class="nav-links">
        <li><a href="index.html" data-i18n="nav_home">Home</a></li>
        <li><a href="menu.html" data-i18n="nav_menu">Menu</a></li>
        <li><a href="about.html" data-i18n="nav_about">About</a></li>
        <li><a href="contact.html" data-i18n="nav_contact">Contact</a></li>
      </ul>
      <div class="lang-switcher">
        <button onclick="setLanguage('en')" id="lang-en">EN</button>
        <button onclick="setLanguage('gr')" id="lang-gr">GR</button>
      </div>
    </nav>
  </header>

  <section class="menu-hero">
    <h1 data-i18n="menu_title">Our Menu</h1>
    <p data-i18n="menu_intro">Discover authentic Greek flavors and traditional recipes</p>
  </section>

  <!-- Category Navigation Bar -->
  <div class="category-nav-container">
    <div class="category-nav" id="categoryNav">
      <!-- Categories will be dynamically populated here -->
    </div>
  </div>

  <section class="menu-section">
    <div id="dynamic-menu"></div>
  </section>

  <script>
  const translations = {
    en: {
      nav_home: 'Home',
      nav_menu: 'Menu',
      nav_about: 'About',
      nav_contact: 'Contact',
      menu_title: 'Our Menu',
      menu_intro: 'Discover authentic Greek flavors and traditional recipes',
      btn_appetizers: 'Appetizers',
      btn_salads: 'Salads',
      btn_main_dishes: 'Main Dishes',
      btn_desserts: 'Desserts',
      btn_drinks: 'Drinks',
      cat_appetizers: 'Appetizers',
      cat_main_dishes: 'Main Dishes',
      cat_salads: 'Salads',
      cat_desserts: 'Desserts',
      cat_drinks: 'Drinks',
      dish_tzatziki: 'Tzatziki',
      desc_tzatziki: 'Greek yogurt, cucumber, garlic, olive oil',
      dish_hummus: 'Hummus',
      desc_hummus: 'Chickpeas, tahini, olive oil, paprika',
      dish_dolmades: 'Dolmades',
      desc_dolmades: 'Grape leaves stuffed with rice and herbs',
      dish_saganaki: 'Saganaki',
      desc_saganaki: 'Fried cheese with lemon',
      dish_keftedes: 'Keftedes',
      desc_keftedes: 'Greek meatballs with herbs',
      dish_moussaka: 'Moussaka',
      desc_moussaka: 'Layers of eggplant, potatoes, and ground beef',
      dish_pastitsio: 'Pastitsio',
      desc_pastitsio: 'Greek lasagna with béchamel sauce',
      dish_souvlaki: 'Souvlaki',
      desc_souvlaki: 'Grilled pork skewers with pita',
      dish_gemista: 'Gemista',
      desc_gemista: 'Stuffed tomatoes and peppers with rice',
      dish_fasolada: 'Fasolada',
      desc_fasolada: 'Traditional bean soup',
      dish_baklava: 'Baklava',
      desc_baklava: 'Layered phyllo with nuts and honey',
      dish_galaktoboureko: 'Galaktoboureko',
      desc_galaktoboureko: 'Custard pie with phyllo',
      dish_kataifi: 'Kataifi',
      desc_kataifi: 'Shredded phyllo with nuts and syrup',
      dish_yogurt_honey: 'Greek Yogurt with Honey',
      desc_yogurt_honey: 'Creamy yogurt with local honey',
      dish_horiatiki: 'Horiatiki',
      desc_horiatiki: 'Greek salad with feta, olives, tomatoes',
      dish_dakos: 'Dakos',
      desc_dakos: 'Cretan salad with barley rusks',
      dish_melitzanosalata: 'Melitzanosalata',
      desc_melitzanosalata: 'Eggplant salad with garlic',
      drink_red_wine: 'Red House Wine',
      desc_red_wine: 'Glass / Bottle',
      drink_white_wine: 'White House Wine',
      desc_white_wine: 'Glass / Bottle',
      drink_retsina: 'Retsina',
      desc_retsina: 'Traditional Greek resinated wine',
      drink_rose: 'Local Rosé',
      desc_rose: 'Local rosé wine',
      drink_ouzo: 'Ouzo',
      desc_ouzo: 'Traditional Greek anise-flavored spirit',
      drink_tsipouro: 'Tsipouro',
      desc_tsipouro: 'Greek grape distillate',
      drink_beer: 'Beer',
      desc_beer: 'Mythos, Fix, Alfa',
      drink_rakomelo: 'Rakomelo',
      desc_rakomelo: 'Honey-flavored raki',
      drink_coca_cola: 'Coca-Cola / Coca-Cola Zero',
      desc_coca_cola: 'Refreshing cola beverages',
      drink_fanta: 'Fanta Orange / Lemon',
      desc_fanta: 'Fruit-flavored sodas',
      drink_sprite: 'Sprite',
      desc_sprite: 'Lemon-lime soda',
      drink_soda_water: 'Soda Water',
      desc_soda_water: 'Sparkling water',
      drink_tonic: 'Tonic',
      desc_tonic: 'Tonic water',
      drink_greek_coffee: 'Greek Coffee',
      desc_greek_coffee: 'Traditional Greek coffee',
      drink_espresso: 'Espresso',
      desc_espresso: 'Strong Italian coffee',
      drink_cappuccino: 'Cappuccino',
      desc_cappuccino: 'Espresso with steamed milk',
      drink_mountain_tea: 'Mountain Tea',
      desc_mountain_tea: 'Greek mountain tea',
      drink_chamomile: 'Chamomile',
      desc_chamomile: 'Soothing chamomile tea',
      drink_iced_coffee: 'Iced Coffee',
      desc_iced_coffee: 'Freddo Espresso / Freddo Cappuccino',
      drink_iced_tea: 'Iced Tea',
      desc_iced_tea: 'Refreshing iced tea',
      drink_fresh_juice: 'Fresh Orange Juice',
      desc_fresh_juice: 'Freshly squeezed orange juice',
      drink_bottled_water: 'Bottled Water',
      desc_bottled_water: 'Small / Large',
      drinks_wines: 'Wines',
      drinks_alcoholic: 'Alcoholic Beverages',
      drinks_soft: 'Soft Drinks',
      drinks_hot: 'Hot Beverages',
      drinks_cold: 'Cold Beverages',
      drinks_coffee: 'Coffee'
    },
    gr: {
      nav_home: 'Αρχική',
      nav_menu: 'Μενού',
      nav_about: 'Σχετικά',
      nav_contact: 'Επικοινωνία',
      menu_title: 'Το Μενού μας',
      menu_intro: 'Ανακαλύψτε αυθεντικές ελληνικές γεύσεις και παραδοσιακές συνταγές',
      btn_appetizers: 'Ορεκτικά',
      btn_salads: 'Σαλάτες',
      btn_main_dishes: 'Κυρίως Πιάτα',
      btn_desserts: 'Επιδόρπια',
      btn_drinks: 'Ποτά',
      cat_appetizers: 'Ορεκτικά',
      cat_main_dishes: 'Κυρίως Πιάτα',
      cat_salads: 'Σαλάτες',
      cat_desserts: 'Επιδόρπια',
      cat_drinks: 'Ποτά',
      dish_tzatziki: 'Τζατζίκι',
      desc_tzatziki: 'Ελληνικό γιαούρτι, αγγούρι, σκόρδο, ελαιόλαδο',
      dish_hummus: 'Χούμους',
      desc_hummus: 'Ρεβίθια, ταχίνι, ελαιόλαδο, πάπρικα',
      dish_dolmades: 'Ντολμάδες',
      desc_dolmades: 'Αμπελόφυλλα γεμιστά με ρύζι και βότανα',
      dish_saganaki: 'Σαγανάκι',
      desc_saganaki: 'Τηγανητό τυρί με λεμόνι',
      dish_keftedes: 'Κεφτέδες',
      desc_keftedes: 'Ελληνικά κεφτεδάκια με βότανα',
      dish_moussaka: 'Μουσάκα',
      desc_moussaka: 'Στρώματα μελιτζάνας, πατάτες και κιμά',
      dish_pastitsio: 'Παστίτσιο',
      desc_pastitsio: 'Ελληνική λαζάνια με μπεσαμέλ',
      dish_souvlaki: 'Σουβλάκι',
      desc_souvlaki: 'Ψητά χοιρινά ξυλάκια με πίτα',
      dish_gemista: 'Γεμιστά',
      desc_gemista: 'Γεμιστές ντομάτες και πιπεριές με ρύζι',
      dish_fasolada: 'Φασολάδα',
      desc_fasolada: 'Παραδοσιακή φασολάδα',
      dish_baklava: 'Μπακλαβάς',
      desc_baklava: 'Στρώματα φύλλων με καρύδια και μέλι',
      dish_galaktoboureko: 'Γαλακτομπούρεκο',
      desc_galaktoboureko: 'Πίτα κρέμας με φύλλο',
      dish_kataifi: 'Καταΐφι',
      desc_kataifi: 'Κομμένο φύλλο με καρύδια και σιρόπι',
      dish_yogurt_honey: 'Ελληνικό Γιαούρτι με Μέλι',
      desc_yogurt_honey: 'Κρεμώδες γιαούρτι με τοπικό μέλι',
      dish_horiatiki: 'Χωριάτικη',
      desc_horiatiki: 'Ελληνική σαλάτα με φέτα, ελιές, ντομάτες',
      dish_dakos: 'Ντάκος',
      desc_dakos: 'Κρητική σαλάτα με κριθαράκι',
      dish_melitzanosalata: 'Μελιτζανοσαλάτα',
      desc_melitzanosalata: 'Σαλάτα μελιτζάνας με σκόρδο',
      drink_red_wine: 'Κόκκινος Οίνος Οίκου',
      desc_red_wine: 'Ποτήρι / Μπουκάλι',
      drink_white_wine: 'Λευκός Οίνος Οίκου',
      desc_white_wine: 'Ποτήρι / Μπουκάλι',
      drink_retsina: 'Ρετσίνα',
      desc_retsina: 'Παραδοσιακός ελληνικός ρετσινάτος οίνος',
      drink_rose: 'Τοπικό Ροζέ',
      desc_rose: 'Τοπικό ροζέ κρασί',
      drink_ouzo: 'Ούζο',
      desc_ouzo: 'Παραδοσιακό ελληνικό πνευματώδες με γλυκάνισο',
      drink_tsipouro: 'Τσίπουρο',
      desc_tsipouro: 'Ελληνικό κρασοσταγμα',
      drink_beer: 'Μπύρα',
      desc_beer: 'Μύθος, Φιξ, Άλφα',
      drink_rakomelo: 'Ρακόμελο',
      desc_rakomelo: 'Ρακί με μέλι',
      drink_coca_cola: 'Coca-Cola / Coca-Cola Zero',
      desc_coca_cola: 'Δροσιστικά ποτά κόλα',
      drink_fanta: 'Fanta Πορτοκάλι / Λεμόνι',
      desc_fanta: 'Φρουτώδη σόδα',
      drink_sprite: 'Sprite',
      desc_sprite: 'Λεμονάδα-λάιμ σόδα',
      drink_soda_water: 'Σόδα',
      desc_soda_water: 'Αεριούχο νερό',
      drink_tonic: 'Τόνικ',
      desc_tonic: 'Τονικό νερό',
      drink_greek_coffee: 'Ελληνικός Καφές',
      desc_greek_coffee: 'Παραδοσιακός ελληνικός καφές',
      drink_espresso: 'Εσπρέσο',
      desc_espresso: 'Δυνατός ιταλικός καφές',
      drink_cappuccino: 'Καπουτσίνο',
      desc_cappuccino: 'Εσπρέσο με ατμόγαλα',
      drink_mountain_tea: 'Βουνίσιος Τσάι',
      desc_mountain_tea: 'Ελληνικό βουνίσιο τσάι',
      drink_chamomile: 'Καμομήλι',
      desc_chamomile: 'Ηρεμιστικό τσάι καμομήλι',
      drink_iced_coffee: 'Παγωμένος Καφές',
      desc_iced_coffee: 'Φρέντο Εσπρέσο / Φρέντο Καπουτσίνο',
      drink_iced_tea: 'Παγωμένο Τσάι',
      desc_iced_tea: 'Δροσιστικό παγωμένο τσάι',
      drink_fresh_juice: 'Φρέσκο Πορτοκαλάδα',
      desc_fresh_juice: 'Φρέσκο χυμό πορτοκαλιού',
      drink_bottled_water: 'Νερό σε Μπουκάλι',
      desc_bottled_water: 'Μικρό / Μεγάλο',
      drinks_wines: 'Κρασιά',
      drinks_alcoholic: 'Πνευματώδη Ποτά',
      drinks_soft: 'Αναψυκτικά',
      drinks_hot: 'Ζεστά Ποτά',
      drinks_cold: 'Κρύα Ποτά',
      drinks_coffee: 'Καφές'
    }
  };

  function setLanguage(lang) {
    // Save language preference to localStorage
    localStorage.setItem('selectedLanguage', lang);
    
    const elements = document.querySelectorAll('[data-i18n]');
    elements.forEach(el => {
      const key = el.getAttribute('data-i18n');
      if (translations[lang][key]) {
        el.innerHTML = translations[lang][key];
      }
    });
    document.getElementById('lang-en').classList.toggle('active', lang === 'en');
    document.getElementById('lang-gr').classList.toggle('active', lang === 'gr');
    
    // Re-render the menu with the new language
    if (window.menuData) {
      renderMenu(window.menuData);
    }
  }

  function showCategory(categoryId) {
    // Hide all categories
    const categories = document.querySelectorAll('.menu-category');
    categories.forEach(cat => cat.classList.remove('active'));
    
    // Show selected category
    document.getElementById(categoryId).classList.add('active');
    
    // Update button states
    const buttons = document.querySelectorAll('.menu-btn');
    buttons.forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
  }

  // Load saved language preference or default to English
  function loadSavedLanguage() {
    const savedLanguage = localStorage.getItem('selectedLanguage');
    const defaultLanguage = savedLanguage || 'en';
    setLanguage(defaultLanguage);
  }
  
  // Initialize language when page loads
  loadSavedLanguage();

  const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTmkkP3zI0_a5U3cLy18-JRkH9691rsFLvvDVG5C2ijRBw6BxmdbIWfeH2nVqZfDBFSth71FrnpmZrJ/pub?output=csv";

  function parseCSV(text) {
    const lines = text.trim().split('\n');
    const headers = lines[0].split(',').map(h => h.trim());

    // This regex correctly splits by comma, but ignores commas inside double quotes
    const regex = /(".*?"|[^",]+)(?=\s*,|\s*$)/g;
    
    return lines.slice(1).map(line => {
        const values = line.match(regex) || [];
        const obj = {};
        headers.forEach((header, i) => {
            let value = (values[i] || '').trim();
            // Remove quotes from start and end if they exist
            if (value.startsWith('"') && value.endsWith('"')) {
                value = value.substring(1, value.length - 1);
            }
            obj[header] = value;
        });
        return obj;
    });
}

  // Enhanced function to ensure first category is active by default
  function setDefaultActiveCategory() {
    const categoryBtns = document.querySelectorAll('.category-btn');
    if (categoryBtns.length > 0) {
      // Set the first category as active by default
      categoryBtns[0].classList.add('active');
      
      // Scroll to make it visible
      scrollCategoryIntoView(categoryBtns[0]);
    }
  }

  // Function to handle window resize and ensure active category is visible
  function handleWindowResize() {
    const activeBtn = document.querySelector('.category-btn.active');
    if (activeBtn) {
      // Ensure active button is visible after resize
      setTimeout(() => {
        scrollCategoryIntoView(activeBtn);
      }, 100);
    }
  }

  // Enhanced renderMenu function with better category handling
  function renderMenu(items) {
    const menuDiv = document.getElementById('dynamic-menu');
    const categoryNav = document.getElementById('categoryNav');
    if (!menuDiv || !categoryNav) return;

    // Get current language
    const currentLang = localStorage.getItem('selectedLanguage') || 'en';
    
    // Determine which columns to use based on language
    const dishNameColumn = currentLang === 'gr' ? 'Dish Name GR' : 'Dish Name';
    const descriptionColumn = currentLang === 'gr' ? 'Description GR' : 'Description';
    const categoryColumn = currentLang === 'gr' ? 'Category GR' : 'Category';

    // Group items by normalized category
    const grouped = {};
    items.forEach(item => {
      if (item.Available && item.Available.trim().toLowerCase() === 'true') {
        // Use the appropriate category column based on language
        const rawCategory = item[categoryColumn] || item.Category || '';
        const category = rawCategory.trim().toLowerCase();
        if (!grouped[category]) grouped[category] = { name: rawCategory.trim(), items: [] };
        grouped[category].items.push(item);
      }
    });

    // Sort categories by their first appearance
    const orderedCategories = Object.values(grouped);

    // Build category navigation
    let navHtml = '';
    orderedCategories.forEach((group, index) => {
      const categoryId = `category-${index}`;
      navHtml += `<button class="category-btn" data-category="${categoryId}">${group.name}</button>`;
    });
    categoryNav.innerHTML = navHtml;

    // Build menu HTML
    let html = '';
    orderedCategories.forEach((group, index) => {
      const categoryId = `category-${index}`;
      html += `<div id="${categoryId}" class="menu-category-section">`;
      html += `<h2>${group.name}</h2>`;
      group.items.forEach(item => {
        // Use the appropriate columns based on language
        const dishName = item[dishNameColumn] || item['Dish Name'] || '';
        const description = item[descriptionColumn] || item.Description || '';
        
        html += `
          <div class="menu-item">
            <div class="menu-item-name"><strong>${dishName}</strong> <span class="menu-item-price">${item.Price}</span></div>
            <div class="menu-item-desc">${description}</div>
          </div>
        `;
      });
      html += `</div>`;
    });
    menuDiv.innerHTML = html;

    // Add click event listeners to category buttons
    const categoryBtns = document.querySelectorAll('.category-btn');
    categoryBtns.forEach(btn => {
      btn.addEventListener('click', function() {
        const categoryId = this.getAttribute('data-category');
        scrollToCategory(categoryId);
      });
    });

    // Initialize intersection observer for active category highlighting
    initializeCategoryObserver();
    
    // Set default active category after a short delay to ensure DOM is ready
    setTimeout(() => {
      setDefaultActiveCategory();
    }, 100);
    
    // Also add scroll event listener as fallback
    window.addEventListener('scroll', updateActiveCategoryOnScroll);
    
    // Add window resize listener to handle responsive behavior
    window.addEventListener('resize', handleWindowResize);
  }

  // Enhanced scrollToCategory function with proper offset for sticky header
  function scrollToCategory(categoryId) {
    const element = document.getElementById(categoryId);
    const categoryBtns = document.querySelectorAll('.category-btn');
    
    if (element) {
      // Remove active class from all buttons
      categoryBtns.forEach(btn => btn.classList.remove('active'));
      
      // Add active class to the clicked button
      const activeBtn = document.querySelector(`[data-category="${categoryId}"]`);
      if (activeBtn) {
        activeBtn.classList.add('active');
        
        // Scroll the category navigation to make the active button visible
        scrollCategoryIntoView(activeBtn);
      }
      
      // Calculate proper offset for sticky header and category navigation
      const headerHeight = document.querySelector('header').offsetHeight;
      const navHeight = document.querySelector('.category-nav-container').offsetHeight;
      const offset = headerHeight + navHeight + 30; // Added extra padding for better visibility
      
      // Get the element's position relative to the viewport
      const elementRect = element.getBoundingClientRect();
      const elementTop = elementRect.top + window.pageYOffset;
      
      // Calculate the target scroll position with proper offset
      const targetScrollTop = elementTop - offset;
      
      // Smooth scroll to the target position
      window.scrollTo({
        top: targetScrollTop,
        behavior: 'smooth'
      });
    }
  }

  // Function to scroll category navigation to keep active button visible
  function scrollCategoryIntoView(activeButton) {
    const categoryNav = document.getElementById('categoryNav');
    const buttonRect = activeButton.getBoundingClientRect();
    const navRect = categoryNav.getBoundingClientRect();
    
    // Check if button is outside the visible area
    if (buttonRect.left < navRect.left || buttonRect.right > navRect.right) {
      // Calculate scroll position to center the active button
      const scrollLeft = activeButton.offsetLeft - (navRect.width / 2) + (buttonRect.width / 2);
      
      // Ensure we don't scroll beyond the boundaries
      const maxScrollLeft = categoryNav.scrollWidth - categoryNav.clientWidth;
      const finalScrollLeft = Math.max(0, Math.min(scrollLeft, maxScrollLeft));
      
      categoryNav.scrollTo({
        left: finalScrollLeft,
        behavior: 'smooth'
      });
    }
  }

  function initializeCategoryObserver() {
    // This function is now simplified - we'll use the scroll event for precise control
    // Just set up the initial active category
    setDefaultActiveCategory();
  }

  function updateActiveCategoryOnScroll() {
    const categorySections = document.querySelectorAll('.menu-category-section');
    const categoryBtns = document.querySelectorAll('.category-btn');
    
    // Calculate the sticky header offset (where content becomes visible)
    const headerHeight = document.querySelector('header').offsetHeight;
    const navHeight = document.querySelector('.category-nav-container').offsetHeight;
    const stickyOffset = headerHeight + navHeight;
    
    // Find which category section is currently at the top of the visible area
    let activeSection = null;
    
    // Special handling for when we're at the very top of the page
    if (window.pageYOffset <= stickyOffset) {
      // We're at the top, so the first section should be active
      activeSection = categorySections[0];
    } else {
      // Find which section has passed the sticky header
      categorySections.forEach(section => {
        const rect = section.getBoundingClientRect();
        const sectionTop = rect.top;
        
        // Check if this section's top edge has passed the sticky header
        // We want to activate when the section top is just below the sticky header
        if (sectionTop <= stickyOffset + 5) { // 5px tolerance for smooth transitions
          activeSection = section;
        }
      });
    }
    
    if (activeSection) {
      const categoryId = activeSection.id;
      const activeBtn = document.querySelector(`[data-category="${categoryId}"]`);
      
      if (activeBtn && !activeBtn.classList.contains('active')) {
        // Remove active class from all buttons
        categoryBtns.forEach(btn => btn.classList.remove('active'));
        
        // Add active class to the new active button
        activeBtn.classList.add('active');
        
        // Scroll the category navigation to make the active button visible
        scrollCategoryIntoView(activeBtn);
      }
    }
  }

  // Add scroll event listener for precise category detection
  window.addEventListener('scroll', () => {
    // Throttle the scroll event for better performance
    if (!window.scrollTimeout) {
      window.scrollTimeout = setTimeout(() => {
        updateActiveCategoryOnScroll();
        window.scrollTimeout = null;
      }, 16); // ~60fps for smooth responsiveness
    }
  });

  fetch(SHEET_URL)
    .then(response => response.text())
    .then(csv => {
      const items = parseCSV(csv);
      // Store menu data globally for language switching
      window.menuData = items;
      renderMenu(items);
    })
    .catch(err => {
      document.getElementById('dynamic-menu').innerHTML = "Menu unavailable.";
      console.error("Menu fetch error:", err);
    });
  </script>
</body>
</html> 